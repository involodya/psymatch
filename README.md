# PsyMatch - Telegram Bot для подбора психологов

Бот для матчинга психологов и пациентов на основе психологической совместимости.

## Функционал

### Для пациентов:
- Регистрация с указанием основного запроса
- Прохождение психологического теста
- Просмотр психологов с процентом совместимости
- Навигация вперед/назад по карточкам
- Лайки психологов
- Уведомления о взаимных лайках с контактами

### Для психологов:
- Регистрация с фото и профессиональной информацией
- Прохождение психологического теста
- Получение уведомлений о лайках от пациентов
- Просмотр списка всех лайкнувших пациентов
- Возможность лайкнуть в ответ для создания метча

### Для администраторов:
- Статистика: количество психологов, пациентов
- Активные пользователи за 24 часа
- Количество созданных пар
- Пары за последние 24 часа

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Создайте `.env` файл на основе `.env.example`:
```bash
cp .env.example .env
```

3. Заполните `.env` файл:
- `BOT_TOKEN` - токен вашего Telegram бота от @BotFather
- `ADMIN_IDS` - ID администраторов через запятую (например: 123456789,987654321)
- `DATABASE_PATH` - путь к файлу базы данных (по умолчанию: psymatch.db)
- `LOG_FILE` - путь к файлу логов (по умолчанию: bot.log)

4. Запустите бота:
```bash
python3 bot.py
```

## Структура проекта

- `bot.py` - главный файл бота с обработчиками
- `database.py` - работа с базой данных SQLite
- `matching.py` - система расчета совместимости
- `messages.json` - все текстовые сообщения бота
- `test_questions.json` - вопросы психологического теста
- `requirements.txt` - зависимости проекта

## Настройка теста

Вопросы теста находятся в файле `test_questions.json`. Каждый вопрос содержит:
- `question` - текст вопроса
- `options` - варианты ответов (5 вариантов)
- `weights` - веса для каждого ответа (массив из 5 чисел от -1 до 1)

Веса определяют вклад ответа в вектор ценностей пользователя. Совместимость рассчитывается на основе косинусного сходства векторов.

## Аналитика

Бот логирует следующие события:
- `command_start` - запуск бота
- `role_selected` - выбор роли (психолог/пациент)
- `patient_request_entered` - ввод запроса пациентом
- `patient_profile_completed` - завершение регистрации пациента
- `psychologist_photo_uploaded` - загрузка фото психологом
- `psychologist_profile_completed` - завершение регистрации психолога
- `test_answer` - ответ на вопрос теста (с номером вопроса и ответа)
- `test_completed` - завершение теста
- `browse_start` - начало просмотра психологов
- `card_viewed` - просмотр карточки (с индексом, ID психолога и процентом совместимости)
- `like_sent` - отправка лайка (с ID получателя, флагом взаимности и процентом совместимости)
- `match_created` - создание взаимного метча
- `view_likes` - просмотр списка лайков
- `view_stats` - просмотр статистики

Все действия логируются в файл `bot.log` и дублируются в консоль.
